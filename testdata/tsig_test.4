# Test with algorithm
file-algorithm sha256

tsig-key:
	name: "test.key"
	algorithm: sha256
	secret: "K2tf3TRjvQkVCmJF3/Z9vA=="

packet
# www.example.net. IN TXT
3a03010000010000000000000377777707657861
6d706c65036e65740000100001
endpacket

# sign the query with <key> <timepoint> <expected function ret>
tsig-sign-query test.key 1750411954 1

check-packet
3a030100000100000000000103777777076578616d706c65036e657400001000010474657374036b65790000fa00ff00000000003d0b686d61632d73686132353600000068552ab2012c00200c35a60a42461678af59a10fbb1a18dcca69e62d58abdc8be808ab095d4beb403a0300000000
endpacket

# www.example.net A
packet
c7580000000100000000000103777777076578616d706c65036e657400000100010000291000000000000000
endpacket

tsig-sign-query test.key 1750421767 1

check-packet
c7580000000100000000000203777777076578616d706c65036e6574000001000100002910000000000000000474657374036b65790000fa00ff00000000003d0b686d61632d73686132353600000068555107012c0020aa49c7e324b075dd057aeaba998ee10b6c72f8573f56d3b42fb2f65ee1e81f76c75800000000
endpacket

tsig-verify-query test.key 1750421767 NOERROR NOERROR 0

packet
c7580000000100000000000203777777076578616d706c65036e6574000001000100002910000000000000000474657374036b65790000fa00ff00000000003d0b686d61632d73686132353600000068555107012c0020aa49c7e324b075dd057aeaba998ee10b6c72f8573f56d3b42fb2f65ee1e81f76c75800000000
endpacket

tsig-sign-reply 1750421767 NOERROR 1
c758840000010001000000010377777707657861
6d706c65036e65740000010001c00c0001000100
000e1000040a141e2800002904d0000000000000
endpacket

# reply for www.example.net A
check-packet
c7588400000100010000000203777777076578616d706c65036e65740000010001c00c0001000100000e1000040a141e2800002904d00000000000000474657374036b65790000fa00ff00000000003d0b686d61632d73686132353600000068555107012c0020a377c921817d4009a6ab35e7f84aa697751b3a976701e8fb6b843965325bf9bdc75800000000
endpacket

packet
c7588400000100010000000103777777076578616d706c65036e65740000010001c00c0001000100000e1000040a141e2800002904d0000000000000
endpacket

tsig-sign-shared test.key 1750411954 0

check-packet
c7588400000100010000000203777777076578616d706c65036e65740000010001c00c0001000100000e1000040a141e2800002904d00000000000000474657374036b65790000fa00ff00000000003d0b686d61632d73686132353600000068552ab2012c00206a0e6bb9e1228588a8edd5da1dd611bcd0b4e2dd815e7c5501825ea374b3ebacc75800000000
endpacket

tsig-verify-shared test.key 1750411954 0

# www.example.net A
packet
c7580000000100000000000103777777076578616d706c65036e657400000100010000291000000000000000
endpacket

tsig-verify-reply test.key 1750421767 1 1
c7588400000100010000000203777777076578616d706c65036e65740000010001c00c0001000100000e1000040a141e2800002904d00000000000000474657374036b65790000fa00ff00000000003d0b686d61632d73686132353600000068555107012c0020a377c921817d4009a6ab35e7f84aa697751b3a976701e8fb6b843965325bf9bdc75800000000
endpacket

# www.example.net A
packet
c7580000000100000000000103777777076578616d706c65036e657400000100010000291000000000000000
endpacket

# the reply packet has a wrong tsig signature. The A record is modified.
tsig-verify-reply test.key 1750421767 1 0
c7588400000100010000000203777777076578616d706c65036e65740000010001c00c0001000100000e1000040a141e4800002904d00000000000000474657374036b65790000fa00ff00000000003d0b686d61632d73686132353600000068555107012c0020a377c921817d4009a6ab35e7f84aa697751b3a976701e8fb6b843965325bf9bdc75800000000
endpacket

# example.com. AXFR
packet
74c400000001000000000001076578616d706c6503636f6d0000fc00010000291000000000000000
endpacket

tsig-sign-query test.key 1756302015 1

check-packet
74c400000001000000000002076578616d706c6503636f6d0000fc000100002910000000000000000474657374036b65790000fa00ff00000000003d0b686d61632d73686132353600000068af0abf012c00207652f5647d92370be5ae6c5e748519845779e02ecdb95c5a0829b712c26563d374c400000000
endpacket

packet
74c400000001000000000002076578616d706c6503636f6d0000fc000100002910000000000000000474657374036b65790000fa00ff00000000003d0b686d61632d73686132353600000068af0abf012c00207652f5647d92370be5ae6c5e748519845779e02ecdb95c5a0829b712c26563d374c400000000
endpacket

tsig-sign-reply 1756302015 NOERROR 1
74c484000001000200000001076578616d706c6503636f6d0000fc0001c00c0006000100000e100023c00c0a686f73746d6173746572c00c5cd7fffe00000e10000003840012750000000708c00c0001000100000e1000043ed26e0700002904d0000000000000
endpacket

check-packet
74c484000001000200000002076578616d706c6503636f6d0000fc0001c00c0006000100000e100023c00c0a686f73746d6173746572c00c5cd7fffe00000e10000003840012750000000708c00c0001000100000e1000043ed26e0700002904d00000000000000474657374036b65790000fa00ff00000000003d0b686d61632d73686132353600000068af0abf012c0020df2b53f8f88720570cd0cb8f31e315037d68e95c380674f5439793a576ef615e74c400000000
endpacket

packet
74c400000001000000000001076578616d706c6503636f6d0000fc00010000291000000000000000
endpacket

tsig-verify-reply test.key 1756302015 1 1
74c484000001000200000002076578616d706c6503636f6d0000fc0001c00c0006000100000e100023c00c0a686f73746d6173746572c00c5cd7fffe00000e10000003840012750000000708c00c0001000100000e1000043ed26e0700002904d00000000000000474657374036b65790000fa00ff00000000003d0b686d61632d73686132353600000068af0abf012c0020df2b53f8f88720570cd0cb8f31e315037d68e95c380674f5439793a576ef615e74c400000000
endpacket
